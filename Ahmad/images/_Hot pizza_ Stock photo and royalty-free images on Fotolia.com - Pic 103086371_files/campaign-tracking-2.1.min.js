/*! campaign-tracking v2.1.2 2016-11-07 08:45 UTC */
!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof self&&(b=self),b.CampaignTrackingRules=a()}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(){"use strict";function a(a,b,c){var d=a.split(b),e=d.shift();return c(e,d.join(b))}function d(b){var c={hash:"",host:"",hostname:"",origin:"",pathname:"",protocol:"",search:"",password:"",username:"",port:""};return a(b,"#",function(b,d){d&&(c.hash=d?"#"+d:""),a(b,"?",function(b,d){d&&(c.search="?"+d),b&&a(b,"//",function(b,d){c.protocol=b,a(d,"/",function(b,d){c.pathname="/"+(d||""),(c.protocol||b)&&(c.origin=c.protocol+"//"+b),a(b,"@",function(b,d){if(d){var e=b.split(":");c.username=e[0],c.password=e[1]}else d=b;c.host=d,a(d,":",function(a,b){c.hostname=a,b&&(c.port=b)})})})})})}),c.href=c.origin+c.pathname+c.search+c.hash,c}function e(a){var b={},c=a.search;if(c){c=c.replace(new RegExp("\\?"),"");var d=c.split("&");for(var e in d)if(d.hasOwnProperty(e)&&d[e]){var f=d[e].split("=");b[f[0]]=f[1]}}return b}function f(a){var b=h[a];return"undefined"!=typeof b?b:(b=d(a),b.params=e(b),h[a]=b,b)}var g=this,h={};return f.changeQueryParser=function(a){e=a},"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=f),c.liteURL=f):g.liteURL=f,f}).call(this)},{}],2:[function(a,b,c){function d(a,b){function c(){return j}function d(){return b}function f(){return a}function g(){var c={};return c[k]=b,c[l]=a,e.toQueryString(e.extend({},j,c))}function h(a){j=a}function i(){if(!a||!b)throw new Error("missing required info for campaign")}var j={},k="adType",l="caId";return i(),{getId:f,getAdType:d,getParams:c,setParams:h,getQueryString:g}}var e=a("./micro-utils");b.exports=d},{"./micro-utils":9}],3:[function(a,b,c){var d,e,f="script",g=function(a){d=a,e=d.document};g.prototype.justSend=function(a){var b=new d.Image;return b.src=a,b},g.prototype.runJs=function(a){var b=e.createElement(f);b.async=!0,b.src=a;var c=e.getElementsByTagName(f)[0];return c.parentNode.insertBefore(b,c),b},b.exports=g},{}],4:[function(a,b,c){function d(a,b,c){var d=b||console;this.consoleHas=[],this.prefix=a||"",this.disabled=!!c,this.canApply=!1,e.isDefined(d)&&e.isDefined(d[g])?(this.consoleHas=e.filterArray(n,function(a){return e.isDefined(d[a])}),this.nativeConsole=this.sanitiseConsole(d)):this.disabled=!0}var e=a("./micro-utils"),f="dir",g="log",h="info",i="error",j="group",k="groupCollapsed",l="groupEnd",m="table",n=[f,g,h,i,j,k,l,m];d.prototype.sanitiseConsole=function(a){if(e.isFunction(a[g]))return this.canApply=!0,a;if(Function.prototype.call&&Function.prototype.call.bind){this.canApply=!0;var b={};return e.forEach(this.consoleHas,function(c){b[c]=Function.prototype.call.bind(a[c],a)},this),b}return this.canApply=!1,a},e.forEach(n,function(a){d.prototype[a]=function(){var b=e.arraySlice(arguments,0),c=a;e.inArray(this.consoleHas,c)?this._log(c,b):c===m&&!e.inArray(this.consoleHas,m)&&e.isArray(b[0])&&e.inArray(this.consoleHas,f)?e.forEach(b[0],function(a){this._log(f,[a])},this):e.inArray(this.consoleHas,g)&&this._log(g,b)},d.prototype[a+"Prefixed"]=function(){var b=this.prefix?this.prefix+" - ":"",c=e.arraySlice(arguments,0);b=(new Date).getTime()+" - "+b,c[0]=b+c[0],d.prototype[a].apply(this,c)}}),d.prototype._log=function(a,b){this.disabled||(b=e.arraySlice(b,0),this.canApply?this.nativeConsole[a].apply(this.nativeConsole,b):this.nativeConsole[a](b))},d.prototype.disableLogging=function(){this.disabled=!0},b.exports=d},{"./micro-utils":9}],5:[function(a,b,c){function d(a,b,c){var d=b||window;this.logger=a||d.console,this.doc=d.document,this.recentlySeen=c}function e(a){var b=!1;if(h.isDefined(a))switch(a){case q:b=!0;break;case r:b=!1;break;default:throw new Error("Unknown quantifier: "+a)}return b}var f=a("./Campaign"),g=a("./resolveSource"),h=a("./micro-utils"),i=a("./compare"),j="p",k="t",l="c",m="cp",n="s",o="sp",p="q",q="any",r="all",s="r",t="c",u="ad",v="cid",w=["adType","tmad"],x=["caId","tmcampid"];d.prototype.matchRule=function(a){var b=g(a[n],a[o],this.recentlySeen,this.doc);return i(b,a[l],a[m],a[k])},d.prototype.matchRules=function(a,b){var c,d=e(b),f=!d,j=0;return 0===a.length?(this.logger.log("No rules found - ruleset succeeds automatically"),!0):(c=h.mapArray(a,function(a){var b,c;try{b=this.matchRule(a),b?(j++,c="Pass"):c="Fail"}catch(a){c=a.toString()}return{source:g.getSourceDescription(a[n]),sourceParam:g.getSourceParamDescription(a[o]),comparator:i.getComparatorDescription(a[l]),comparatorParam:i.getComparatorParamDescription(a[m]),testValue:a[k],outcome:c}},this),this.logger.table(c),!!(d&&j>0)||!(!f||j!==a.length))},d.prototype.getCampaignFromUrl=function(){var a=h.extend({},h.parseUrl(this.doc.location.toString()).params);try{var b=h.find(x,function(b){return h.extractIndex(b,a)}),c=h.find(w,function(b){return h.extractIndex(b,a)}),d=new f(b,c);return d.setParams(a),d}catch(a){}},d.prototype.getCampaignFromConfig=function(a){var b=new f(a[t][v],a[t][u]),c=h.mapObject(a[j]||{},function(a,b){return h.isObject(b)?g(b[n],b[o],this.recentlySeen,this.doc):b},this);return b.setParams(c),b},d.prototype.getCampaignFromTrackingItems=function(a){return this.logger.log("Processing %d tracking items",a.length),h.find(a,function(a,b){var c=b+1;if(a[s]&&a[p]){var d=this.getCampaignFromConfig(a),e=a[p],f=a[s];this.logger.groupCollapsed("Testing tracking item "+c+" (requires "+e+" of "+f.length+' rule(s) to attribute activity against campaign: "'+d.getId()+'")');var g=this.matchRules(f,e);if(this.logger.groupEnd(),g)return this.logger.log("Tracking %d passed",c),d;this.logger.log("Tracking %d failed",c)}else this.logger.error("No rules found for item: %d",c)},this)},d.prototype.getCampaign=function(a){var b,c=this.getCampaignFromUrl();return c?b="url":(this.logger.log("No campaign activity from URL params (%s and %s); moving onto rules",x.join("/"),w.join("/")),c=this.getCampaignFromTrackingItems(a),c&&(b="rules")),c?this.logger.info('Activity determined by page %s and attributed to campaign: "%s"',b,c.getId()):this.logger.log("No campaign activity attributed"),c},b.exports=d},{"./Campaign":2,"./compare":7,"./micro-utils":9,"./resolveSource":10}],6:[function(a,b,c){function d(a,b){return Math.floor(Math.random()*(b-a+1))+a}var e=a("./micro-utils"),f=a("./lite-mustache"),g=a("./Tracking"),h=a("./Logger"),i=a("./LiteRequest"),j="EJPCB",k="callback",l="conRev",m="conDesc",n="conRef",o="//{{&host}}/{{&account}}/tman.cgi?{{&queryParams}}",p="//{{&host}}/pc/{{&account}}/?{{&queryParams}}",q="seenRecently",r="1",s="t.nc0.co",t="ens-campaign-tracking",u={domains:{cookie:null,logging:s},isLegacyThirdParty:!1},v=function(a,b,c,d,f){if(!e.isObject(a))throw new Error("config needed!");if(!a.account)throw new Error("you need an account to log against");this.win=b||window,this.doc=this.win.document,this.logger=d||new h(t,this.win.console),this.req=f||new i(this.win),this.config=e.deepExtend({},u,a),this.account=this.config.account;var j=this.doc.location.toString();c||"1"===e.parseUrl(j).params.debug?this.logger.log("debug mode enabled"):(this.logger.log("debug mode disabled (add &debug=1 to url to enable)"),this.logger.disableLogging()),this.loggingUrl=this.config.isLegacyThirdParty?o:p,this.config.forceHTTPS&&(this.loggingUrl="https:"+this.loggingUrl);var k=e.getCookie(q,this.doc);this.tracker=new g(this.logger,this.win,k)};v.prototype.dropSeenCookie=function(a){e.cookie(q,r,{expires:new Date(+new Date+6e5),path:"/",domain:a},this.doc),this.logger.log("Marking this user as seen before using cookie %s against domain %s",q,a)},v.prototype.makeRequest=function(a,b){var c=f(this.loggingUrl,{host:this.config.domains.logging,account:this.account,queryParams:a});this.logger.log("Logging activity: %s",c),this.req[b?"runJs":"justSend"](c)},v.prototype.logCampaignEvent=function(a){this.makeRequest(a.getQueryString())},v.prototype.trackCampaigns=function(a){var b;if(this.logger.groupPrefixed("Campaign activity analysis"),a=a||[],!e.isArray(a))throw new Error("The tracking items need to be an array");try{b=this.tracker.getCampaign(a)}catch(a){throw this.logger.error(a.toString()),this.logger.groupEnd(),a}return this.dropSeenCookie(this.config.domains.cookie),b&&this.logCampaignEvent(b),this.logger.groupEnd(),b},v.prototype.logConversion=function(a,b){this.logger.groupPrefixed("Conversion logging");var c=j+"_"+ +new Date+d(1,1e4);if(e.isUndefined(a[l])||e.isUndefined(a[m])||e.isUndefined(a[n]))throw new Error('you need to include "'+l+'", "'+m+'" or "'+n+'" in your params to log a conversion');a[k]=c;var f=e.toQueryString(a),g=this;this.win[c]=function(a){g.logger.log("JSONP callback successfully invoked with conversion data"),delete g.win[c],b&&b(a)},this.makeRequest(f,!0),this.logger.groupEnd()},b.exports=v},{"./LiteRequest":3,"./Logger":4,"./Tracking":5,"./lite-mustache":8,"./micro-utils":9}],7:[function(a,b,c){function d(a,b){for(var c=0,d=a.length;c<d;c++)if(b.indexOf(a[c])>-1)return c;return-1}function e(a){var b=a.split(",");if(1===b.length&&""===b[0])return[];for(var c=0,d=b.length;c<d;c++)b[c]=i.trim(b[c]);return b}function f(a,b){if(a===y)a=j;else{if(a!==z)throw new Error("List requested is not defined");a=k}return i.matchesPatternInList(b,a)}function g(a,b,c){return i.isUndefined(c)&&(c=""),b&&f(b,a)||d(e(c),a)>-1}function h(a,b,c,d){if("e"!==b){if(i.isUndefined(c)&&i.isUndefined(d))throw new Error("Missing required parameter");i.isUndefined(a)&&(a="")}switch(b){case l:return a==d;case m:return a!=d;case n:return a-d<0;case o:return a-d<=0;case p:return a-d>0;case q:return a-d>=0;case r:return String(a).indexOf(d)>=0;case s:return String(a).indexOf(d)<0;case t:return 0===String(a).indexOf(d);case u:if(i.isUndefined(d)||""===d)throw new Error("invalid regex supplied");return new RegExp(d).test(a);case v:return i.isDefined(a);case w:return g(a,c,d);case x:return!g(a,c,d);default:throw new Error("Unknown comparator: "+b)}}var i=a("./micro-utils"),j=a("./search-list"),k=a("./social-list"),l="=",m="!=",n="<",o="<=",p=">",q=">=",r="c",s="!c",t="sw",u="r",v="e",w="i",x="!i",y="search",z="social",A={};A[l]="equals",A[m]="not equals",A[n]="less than",A[o]="less or equal to",A[p]="greater than",A[q]="greater or equal to",A[r]="contains",A[s]="doesn't contain",A[t]="starts with",A[u]="matches regex",A[v]="exists",A[w]="in CSV list",A[x]="not in CSV list";var B={};B[y]="search domains",B[z]="social domains",b.exports=h,b.exports.getComparatorDescription=function(a){return A[a]||a},b.exports.getComparatorParamDescription=function(a){return B[a]||a}},{"./micro-utils":9,"./search-list":11,"./social-list":12}],8:[function(a,b,c){function d(a,b,c,d,f){return j.isType(a,"string")?(g=c,f&&(k=f),h=b,i=d,a.replace(k,e)):a}function e(a,b,c){if(h.hasOwnProperty(c))f=j.isUndefined(h[c])?"":h[c];else{if(!g)return a;f=g(c)}return j.isUndefined(f)?a:b!==l?encodeURIComponent(f):i?f:d(f,h,g,!1)}var f,g,h,i,j=a("./micro-utils"),k=/\{\{(&?)([A-Za-z_0-9\-]+)\}\}/g,l="&";b.exports=d},{"./micro-utils":9}],9:[function(a,b,c){function d(a,b,c,d){d=d||document;var e=(a+b).length;if(e>O){if(a.length>O)return!1;b=b.substr(0,O-a.length)}if(!n(b)){if(c=r({},c),null===b&&(c.expires=-1),m(c.expires)){var f=c.expires,g=c.expires=new Date;g.setDate(g.getDate()+f)}var h=[encodeURIComponent(a),"=",c.raw?String(b):encodeURIComponent(String(b)),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("");return d.cookie=h,h}c=b||{};var i=c.raw?function(a){return a}:decodeURIComponent,j=new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(d.cookie);return j?i(j[1]):null}function e(a,b){return d(a,void 0,void 0,b)}function f(a,b){var c=P(a).params,d=c[b];return n(d)?d:decodeURIComponent(d)}function g(a,b){var c="";if(a&&b){b=","+b+",";for(var d=a.split("/"),e=d.length*-1,f=0;f<d.length;f+=1)(b.indexOf(","+f+",")>-1||b.indexOf(","+e+",")>-1)&&(c&&(c+="/"),c+=d[f]),e+=1}return c}function h(a,b){l(b)&&(b=b.split(",")),m(b)&&(b=[b]);var c=P(a).pathname,d=c&&"/"!==c?c.split("/"):[],e=[];return d.length&&b.length&&p(b,function(a){e.push(d[a])}),e.length?e.join("/"):void 0}function i(a){a=a.replace(/^\s\s*/,"");for(var b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)}function j(a,b){return Array.prototype.slice.call(a,b)}function k(a,b){return typeof a===(b||I)}function l(a){return k(a,M)}function m(a){return k(a,L)}function n(a){return typeof a===I}function o(a){return typeof a!==I}function p(a,b,c){var d,e,f,g,h;if(c=c||a,Q(a))for(e=0,f=a.length;e<f&&(g=a[e],h=b.call(c,g,e),h!==!1);e++);else for(d in a)if(a.hasOwnProperty(d)&&(g=a[d],h=b.call(c,d,g),h===!1))break}function q(a,b,c){var d,e;return p(a,function(a,f){if(e=b.call(c,a,f),o(e))return d=e,!1}),d}function r(){var a,b=j(arguments,0);if(!(b.length<2))return a=b[0]||{},t(a,j(b,1),!1),a}function s(){var a,b=j(arguments,0);if(!(b.length<2))return a=b[0]||{},t(a,j(b,1),!0),a}function t(a,b,c){var d,e,f,g;return p(b,function(b){if(null!=b)for(var h in b)if(b.hasOwnProperty(h)){if(e=a[h],f=b[h],a===f)continue;c&&f&&(G(f)||(g=Q(f)))?(g?(g=!1,d=e&&Q(e)?e:[]):d=e&&G(e)?e:{},a[h]=t(d,[f],c)):void 0!==f&&(a[h]=f)}}),a}function u(a,b){for(var c=0,d=a.length;c<d;++c)if(b===a[c])return!0;return!1}function v(a){var b;a="return "+a+";";try{b=new Function(a)}catch(b){throw new Error('Error parsing "'+a+": "+b.toString())}return b()}function w(a,b){if(!Q(a))throw new Error("Only arrays can be mapped");return z(a,function(a){if(!n(a)&&!n(a[b]))return a[b]})}function x(a,b){var c=[];if(!E(a))throw new Error("requires object to build string");return p(a,function(a,d){d=b?d:encodeURIComponent(d),c.push(a+"="+d)}),c.join("&")}function y(a,b){return!!q(b,function(b){var c=new RegExp(b);return!!c.test(a)||void 0})}function z(a,b,c){var d,e=[];if(c=c||a,!Q(a))throw new Error("array?");return p(a,function(a,c){d=b.call(this,a,c),e.push(d)},c),e}function A(a,b,c){var d={};if(c=c||a,!E(a))throw new Error("mapObject want's an object, not: "+typeof a);return p(a,function(a,c){d[a]=b.call(this,a,c)},c),d}function B(a,b,c){c=c||a;var d=[];if(!Q(a))throw new Error("Must be an array");return b=b||function(a){return a},p(a,function(a,c){b.call(this,a,c)&&d.push(a)},c),d}function C(a,b){if(!Q(a))throw new Error("Only arrays can be searched");return B(a,function(a){return!q(b,function(b,c){return n(a[b])||a[b]!==c})})}function D(a,b){if(!E(b)&&!Q(b))throw new Error("can only extract from array or object");if(o(b[a])){var c=b[a];return delete b[a],c}}function E(a){return k(a,J)&&null!==a}function F(a){return k(a,N)}function G(a){return!(!E(a)||a.nodeType)&&!(a.constructor&&!Object.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))}function H(a){return k(a,K)}var I="undefined",J="object",K="boolean",L="number",M="string",N="function",O=4e3,P=a("lite-url"),Q=function(){return n(Array.isArray)?function(a){return"[object Array]"===Object.prototype.toString.call(a)}:Array.isArray}();b.exports={arraySlice:j,cookie:d,parseUrl:P,extend:r,deepExtend:s,extractIndex:D,filterArray:B,find:q,forEach:p,getCookie:e,getPathParts:h,getQueryParam:f,getStem:g,inArray:u,isArray:Q,isBoolean:H,isType:k,isUndefined:n,isObject:E,isNumber:m,isString:l,isDefined:o,isFunction:F,mapArray:z,mapObject:A,matchesPatternInList:y,resolveExpression:v,toQueryString:x,trim:i,pluck:w,where:C}},{"lite-url":1}],10:[function(a,b,c){function d(a){return l.isString(a)&&a.length>0||l.isNumber(a)}function e(a,b){if(!l.isString(b))return a;var c=l.parseUrl(a),d=function(){switch(l.trim(b)){case"":case v:return a;case w:return c.hostname;case x:return c.pathname;case y:return g(a);default:throw new Error("Unknown source param: "+b)}}();return d||void 0}function f(a,b){return l.isString(b)&&(b=l.trim(b))?l.getPathParts(a,b):l.parseUrl(a).pathname||void 0}function g(a){var b=a.indexOf("?");return b>-1?a.substring(b+1):void 0}function h(a,b){if(!d(b))throw new Error("Missing source parameter");return l.getQueryParam(a,b)}function i(a,b){if(!d(a))throw new Error("Missing source parameter");var c=l.getCookie(a,b);return null!==c?c:void 0}function j(a,b){return""===b&&!a}function k(a,b,c,d){var g=d.location.toString(),k=d.referrer;return function(a){switch(a){case n:return e(g,b);case u:return f(g,b);case o:return h(g,b);case s:return i(b,d);case t:return l.resolveExpression(b);case r:return j(c,k);case p:return e(k,b);case q:return h(k,b);case m:return b;default:throw new Error("Unknown source: "+a)}}(a)}var l=a("./micro-utils"),m="s",n="u",o="qp",p="r",q="rp",r="dts",s="c",t="x",u="p",v="f",w="h",x="p",y="q",z={};z[m]="static string",z[n]="current URL",z[u]="current URL path",z[o]="current URL param",z[p]="referring URL",z[q]="referring URL param",z[r]="direct-to-side (has no referrer)",z[s]="cookie",z[t]="JS expression";var A={};A[v]="full URL",A[w]="hostname",A[x]="path",A[y]="query string",b.exports=k,b.exports.getSourceDescription=function(a){return z[a]||a},b.exports.getSourceParamDescription=function(a){return A[a]||a}},{"./micro-utils":9}],11:[function(a,b,c){b.exports=["(^|www\\.)google\\.","(^|\\.)bing\\.","^((?!answers).)*yahoo\\.","(^|\\.)ask\\.","search\\.aol\\.","(^|\\.)baidu\\."]},{}],12:[function(a,b,c){b.exports=["facebook","twitter","(^|\\.)t\\.co$","youtube","answers\\.yahoo","linkedin","pinterest","plus\\..*google\\.","tumblr","(^|\\.)tagged\\.","(^|\\.)reddit\\."]},{}]},{},[6])(6)});